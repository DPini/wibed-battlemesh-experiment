#!/bin/sh

BASE_IPV4="10.P.X.Y"
BASE_IPV6=""
PROTOS="/etc/wbm/protos"
MAC="$(cat /sys/class/net/eth0/address)"
PROTOS_ID=""

help() {
	echo -e "prepare\t\tPrepare the protocols"
	echo -e "start_all\t\tStart all protocols"
	echo -e "stop_all\t\tStop all protocols"
	echo -e "start <proto>\tStart a protocol"
	echo -e "stop <proto>\tStop a protocol"
}

call_proto() {
	local proto="$1"
	local action="$2"
	local virtual_if="$3"
	local actual_if="$4"
	local ipv4="$5"
	local ipv6="$6"
	sh $PROTOS/${1}.sh $action $virtual_if $actual_if $ipv4 $ipv6
}

set_proto_ids() {
	local i=1
	for p in (cd $PROTOS ; ls *.sh)
		do
			PROTOS_ID="$PROTOS_ID\n$p:$i"
			i=$(($i+1))
		done
}

get_pxy() {
	local proto="$1"
	local id=$(echo -e "$PROTOS_ID" | grep $proto | cut -d: -f2)
	local m1=$(printf "%d" 0x$(echo $MAC | cut -d: -f6))
	local m2=$(printf "%d" 0x$(echo $MAC | cut -d: -f5))
	echo "$id $m1 $m2"
}

calc_ipv4() {
	local proto="$1"
	local pxy="$(get_pxy $proto)"
	local p="$(echo $pxy | cut -d' ' -f1)"
	local x="$(echo $pxy | cut -d' ' -f2)"
	local y="$(echo $pxy | cut -d' ' -f3)"

	local ipv4="$(echo $BASE_IPV4 | sed s/P/$p/g)"
	ipv4="$(echo $ipv4 | sed s/X/$x/g)"
	ipv4="$(echo $ipv4 | sed s/Y/$y/g)"

	echo "$ipv4"
}

calc_ipv6() {
}
